# 新規実装案

## 概要

* 既存の実装では（プロトタイプなのもあって）すべてをメモリで管理しているが、初回のロードに非常に時間がかかるので適切にDBを使う
  * 依存関係の計算結果はRDBに載せる
  * 依存関係の更新に必要なデータはredisに載せる

## 初回起動時

* パッケージのデータを読み込む
* 上から順にDBに書き込んでいく
  * はじめの段階ではまだどこも依存関係の計算をしていないので、順繰りに計算していく
  * 依存関係の計算の最中に再帰的に計算していくことになるので、その途中の計算結果もDBに保存していく
  * 何度もDBから読み出すことになると遅くなることが目に見えているので、最初の読み込み段階ではプログラム中のメモリに載せておく
    * メモリに載せておくのが不味そうなら適当に高速なDBを使う
* 依存関係においてAがパッケージBに依存しているとき、依存関係更新のためのDB上にてキーBに対してAを追加する
* DBはパッケージの依存関係を書いたテーブルと、パッケージの情報を書き込むテーブルを作成する

## 二回目以降の起動時

* 普通に起動するだけでOK（にする）
* 起動していない間に追加されたパッケージについて順次追加していく（数が多いのであれば初回起動時のアルゴリズムを使う）

## リクエスト処理時

* パッケージ名とバージョンの指定からその指定に合うものを判断し、DB上から取得する
* (リクエスト回数の多いパッケージに関しては予めキャッシュしておく？)

## パッケージ追加時

* 既存のパッケージからパッケージのデータを計算する
* 依存関係更新のためのDBからそのパッケージに依存するパッケージを調べて、それぞれに対してパッケージの追加の更新をする

# 考えなければいけないこと

* パッケージの依存関係をDBに保存するので、読み込む回数を減らせるように実装する必要がある